#!/usr/bin/env sh
# this is a script to play a couple of recording as a slide deck
# before each recording we load vim and show the name of the recording for a
# few seconds.

usage() {
  echo "`echo $0 | xargs basename`: <directories to play from>"
  exit 1
}

cleanup() {
  rm $tf
  rm $tf.script
}

trap cleanup EXIT

[ -z "$1" ] && usage

name=$1
speed=8
bname="`basename $1`"
shift

for d in $name*; do
  [[ ! -d "$d" ]] && continue

  for f in $d/*.json; do
    tf=`mktemp`

    # slide to show for a few seconds before playing script
    cat <<EOF > $tf.script

  `echo ${f%.json} | xargs basename | cut -c12- | tr '-' ' '`

EOF

    # vim script to read out the name of the file
    # wait for 5 seconds and then exit
    cat <<EOF > $tf
:Goyo
:read $tf.script
G
:sleep 5000m
:q!
EOF

    vim -s $tf
    # setting timeout, so any waits get skipped
    asciinema play -i 2 -s $speed $f
  done
done
